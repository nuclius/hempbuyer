var util=require('\x75\x74\x69\x6C');var express=require('\x65\x78\x70\x72\x65\x73\x73');var reload=require('\x72\x65\x6C\x6F\x61\x64');var q=require('\x71');var sprintf=require('\x73\x70\x72\x69\x6E\x74\x66').sprintf;var common=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x68\x6D\x62\x5F\x63\x6F\x6D\x6D\x6F\x6E');var product=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x68\x6D\x62\x5F\x70\x72\x6F\x64\x75\x63\x74');var category=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x68\x6D\x62\x5F\x63\x61\x74\x65\x67\x6F\x72\x79');var user=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x68\x6D\x62\x5F\x75\x73\x65\x72');var faAPI=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x66\x6F\x72\x77\x61\x72\x64\x61\x75\x63\x74\x69\x6F\x6E\x5F\x61\x70\x69');var _=require('\x75\x6E\x64\x65\x72\x73\x63\x6F\x72\x65');var app=express.Router();var request=require('\x72\x65\x71\x75\x65\x73\x74');var async=require('\x61\x73\x79\x6E\x63');var dateFormat=require('\x64\x61\x74\x65\x66\x6F\x72\x6D\x61\x74');var localm=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x6C\x6F\x63\x61\x6C\x6D\x61\x69\x6C');var stripe=require("\x73\x74\x72\x69\x70\x65")(global.general.stripe_secret);var fs=require('\x66\x73');app["\x67\x65\x74"](['\x2F\x67\x65\x74\x43\x61\x74\x65\x67\x6F\x72\x69\x65\x73\x2F\x3A\x69\x64'],function(_0x6F86,_0x6FAB){var _0x6F61=_0x6F86.param('\x69\x64')!= undefined?_0x6F86.param('\x69\x64'):0;if(_0x6F61>  -1){q.all([category.getCategories(_0x6F86,config.mysql,q,_0x6F61)]).then(function(_0x6F86){var _0x6F61=_0x6F86[0][0];common.successResponse(_0x6FAB,'\x53\x75\x63\x63\x65\x73\x73',_0x6F61)}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}else {}});app["\x67\x65\x74"](['\x2F\x70\x72\x65\x76\x69\x65\x77\x2F'],function(_0x6F61,_0x6F86){console.log('\x72\x65\x71\x2E\x73\x65\x73\x73\x69\x6F\x6E\x2E\x64\x72\x61\x66\x74\x65\x64\x44\x61\x74\x61',_0x6F61.session.draftedData);$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']= _0x6F61.session.draftedData;console.log('\x72\x65\x71',_0x6F61.body);common.tplFile('\x68\x6D\x62\x5F\x70\x72\x65\x76\x69\x65\x77\x5F\x70\x72\x6F\x64\x75\x63\x74\x2E\x74\x70\x6C');common.headerSet(1);common.loadTemplateHeader(_0x6F61,_0x6F86,$arr)});app["\x67\x65\x74"](['\x2F','\x2F\x3A\x69\x64'],function(_0x6F61,_0x6F86){_0x6F61.body.loggedUserId= _0x6F61.session.userid?_0x6F61.session.userid:0;_0x6F61.body.action= (_0x6F61.param('\x61\x63\x74\x69\x6F\x6E')!= undefined)?_0x6F61.param('\x61\x63\x74\x69\x6F\x6E'):'';_0x6F61.body.draft= (_0x6F61.param('\x64\x72\x61\x66\x74')!= undefined)?_0x6F61.param('\x64\x72\x61\x66\x74'):'';if(_0x6F61.body.loggedUserId!= ""&& _0x6F61.body.loggedUserId!= 0){_0x6F61.body.id= (_0x6F61.param('\x69\x64')!= undefined)?_0x6F61.param('\x69\x64'):0;$arr.id= _0x6F61.body.id;$arr.product= {};q.all([product.getProduct(_0x6F61,config.mysql,q),category.getCategories(_0x6F61,config.mysql,q,0),product.getStateList(_0x6F61,config.mysql,q),product.getProductCertificate(_0x6F61,config.mysql,q),product.getProductMediaFiles(_0x6F61,config.mysql,q,'\x69\x6D\x61\x67\x65'),product.getProductMediaFiles(_0x6F61,config.mysql,q,'\x76\x69\x64\x65\x6F'),product.getMeasurements(_0x6F61,config.mysql,q,'\x41\x63\x74\x69\x76\x65')]).then(function(_0x6FAB){if(_0x6FAB[0][0].length> 0){$arr.product= _0x6FAB[0][0][0];$arr.product['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x5F\x64\x61\x74\x65']= _0x6FAB[0][0][0]['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x5F\x64\x61\x74\x65'].split('\x20')[0];$arr.product.contaminant_screening_data= $arr.product.contaminant_screening_data.split('\x2C');$arr.product.certificate_types= $arr.product.certificate_types.split('\x2C')};$arr['\x73\x65\x72\x76\x65\x72\x54\x69\x6D\x65']= dateFormat( new Date(),"\x6D\x6D\x2D\x64\x64\x2D\x79\x79\x79\x79\x20\x48\x48\x3A\x4D\x4D\x3A\x73\x73");$arr.categories= _0x6FAB[1][0];$arr.states= _0x6FAB[2][0];$arr.product['\x70\x72\x6F\x64\x75\x63\x74\x43\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65']= _0x6FAB[3][0];$arr.product['\x70\x72\x6F\x64\x75\x63\x74\x49\x6D\x61\x67\x65\x73']= _0x6FAB[4][0];$arr.product['\x70\x72\x6F\x64\x75\x63\x74\x49\x6D\x61\x67\x65\x73\x5F\x6A\x73\x6F\x6E']= JSON.stringify(_0x6FAB[4][0]);$arr.product['\x70\x72\x6F\x64\x75\x63\x74\x56\x69\x64\x65\x6F\x73']= _0x6FAB[5][0];$arr.product['\x70\x72\x6F\x64\x75\x63\x74\x4D\x65\x61\x73\x75\x72\x65\x6D\x65\x6E\x74\x73']= _0x6FAB[6][0];$arr.renewTime= [{id:1,val:'\x31\x20\x74\x69\x6D\x65'},{id:2,val:'\x32\x20\x74\x69\x6D\x65\x73'},{id:3,val:'\x33\x20\x74\x69\x6D\x65\x73'},{id:4,val:'\x34\x20\x74\x69\x6D\x65\x73'},{id:5,val:'\x35\x20\x74\x69\x6D\x65\x73'},{id:6,val:'\x36\x20\x74\x69\x6D\x65\x73'},{id:7,val:'\x37\x20\x74\x69\x6D\x65\x73'},{id:8,val:'\x38\x20\x74\x69\x6D\x65\x73'}];$arr['\x61\x63\x74\x69\x6F\x6E']= _0x6F61.body.action;$arr['\x64\x72\x61\x66\x74']= _0x6F61.body.draft;common.tplFile('\x68\x6D\x62\x5F\x63\x72\x65\x61\x74\x65\x5F\x70\x72\x6F\x64\x75\x63\x74\x2E\x74\x70\x6C');common.headerSet(1);common.loadTemplateHeader(_0x6F61,_0x6F86,$arr)}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}else {_0x6F86.writeHead(302,{'\x4C\x6F\x63\x61\x74\x69\x6F\x6E':'\x2F\x73\x69\x67\x6E\x69\x6E'});_0x6F86.end();return false}});app.post('\x2F\x70\x6F\x73\x74\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x73\x2F\x3A\x63\x6E\x74\x66\x6C\x65',function(_0x6FD0,_0x6FF5){var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);console.log('\x72\x65\x71\x2E\x66\x69\x6C\x65\x73',_0x6FD0.files);var _0x6FAB={certificates:[]};if(_0x6FD0.param('\x63\x6E\x74\x66\x6C\x65')> 1){for(l in _0x6FD0.files.certificates){_0x6FD0.files.certificates[l].basenam= ( typeof (_0x6FD0.files.certificates[l].name)=== '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64')?'':_0x6FD0.files.certificates[l].name.substr(0,_0x6FD0.files.certificates[l].name.lastIndexOf('\x2E'))};_0x6FAB.certificates= _0x6FD0.files.certificates}else {_0x6FD0.files.certificates.basenam= ( typeof (_0x6FD0.files.certificates.name)=== '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64')?'':_0x6FD0.files.certificates.name.substr(0,_0x6FD0.files.certificates.name.lastIndexOf('\x2E'));_0x6FAB.certificates.push(_0x6FD0.files.certificates)};console.log(_0x6FAB);_0x6FF5.json(_0x6FAB);_0x6FF5.end();return false});app.post(['\x2F\x64\x65\x6C\x65\x74\x65\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65'],function(_0x6FAB,_0x6FD0){var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);if(_0x6FAB.body.certificate_id> 0){q.all([product.deletecertificate(_0x6FAB,_0x6FD0,config.mysql,q)]).then(function(_0x6F61){_0x6FD0.json(1);_0x6FD0.end();return false}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}else {fs.unlink(global.path+ "\x2F\x70\x75\x62\x6C\x69\x63\x2F\x75\x70\x6C\x6F\x61\x64\x73\x2F\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x73\x2F"+ _0x6FAB.body.name,function(_0x6F61){if(!_0x6F61){console.log('\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79\x20\x64\x65\x6C\x65\x74\x65\x64\x20'+ _0x6FAB.body.name)};product.deleteCertificateByName(_0x6FAB,config.mysql,q,_0x6FAB.body.name)});_0x6FD0.json(1);_0x6FD0.end();return false}});app.post('\x2F\x70\x6F\x73\x74\x50\x72\x6F\x64\x75\x63\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74\x2F\x3A\x63\x6E\x74\x66\x6C\x65',function(_0x7089,_0x70D3){var _0x6FF5=require('\x66\x73');var _0x70AE=require('\x72\x65\x71\x75\x65\x73\x74');var _0x7167=_0x7089.body.image;var _0x6F86=require('\x63\x72\x79\x70\x74\x6F');var _0x70F8=_0x6F86.randomBytes(20);var _0x7142=_0x6F86.createHash('\x73\x68\x61\x31').update(_0x70F8).digest('\x68\x65\x78');var _0x711D=_0x7142;var _0x7064=/\/(.*?)$/;try{function _0x6FAB(_0x6F61){var _0x6F86=_0x6F61.match(/^data:([A-Za-z-+\/]+);base64,(.+)$/);var _0x6FAB={};if(_0x6F86.length!== 3){return  new Error('\x49\x6E\x76\x61\x6C\x69\x64\x20\x69\x6E\x70\x75\x74\x20\x73\x74\x72\x69\x6E\x67')};_0x6FAB.type= _0x6F86[1];_0x6FAB.data=  new Buffer(_0x6F86[2],'\x62\x61\x73\x65\x36\x34');return _0x6FAB}var _0x6F61=_0x7167;var _0x701A=_0x6FAB(_0x6F61);var _0x718C=config.path+ "\x2F\x70\x75\x62\x6C\x69\x63\x2F\x75\x70\x6C\x6F\x61\x64\x73\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F";var _0x703F=_0x701A.type.match(_0x7064);var _0x71B1=_0x718C+ _0x711D+ '\x2E'+ _0x703F[1];try{require('\x66\x73').writeFile(_0x71B1,_0x701A.data,function(){var _0x6F86=_0x711D+ '\x2E'+ _0x703F[1];var _0x6F61={};_0x6F61.datumnew= {basenam:_0x711D,name:_0x6F86};_0x6F61.s3Url= global.imgpath;_0x70D3.send(_0x6F61);_0x70D3.end();return false})}catch(error){console.log('\x45\x52\x52\x4F\x52\x20\x46\x49\x52\x53\x54\x3A',error)}}catch(error){var _0x6FD0={};;;console.log('\x45\x52\x52\x4F\x52\x3A',error);_0x6FD0.s3Url= global.imgpath;_0x70D3.send(_0x6FD0);_0x70D3.end();return false}});app.post(['\x2F\x64\x65\x6C\x65\x74\x65\x50\x72\x6F\x64\x75\x63\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74'],function(_0x6FAB,_0x6FD0){var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);if(_0x6FAB.body.certificate_id> 0){_0x6FD0.json(1);_0x6FD0.end();return false}else {fs.unlink(global.path+ "\x2F\x70\x75\x62\x6C\x69\x63\x2F\x75\x70\x6C\x6F\x61\x64\x73\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F"+ _0x6FAB.body.name,function(_0x6F61){if(!_0x6F61){console.log('\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79\x20\x64\x65\x6C\x65\x74\x65\x64\x20'+ _0x6FAB.body.name)};product.deleteProductDocumentByName(_0x6FAB,config.mysql,q,_0x6FAB.body.name)});_0x6FD0.json(1);_0x6FD0.end();return false}});app.post(['\x2F\x73\x61\x76\x65\x44\x72\x61\x66\x74\x44\x61\x74\x61'],function(_0x701A,_0x703F){var _0x6FD0=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6FD0({},$arr);var _0x6FAB={};var _0x6F86=_0x701A.body.draftData?_0x701A.body.draftData:[];if(_0x6F86.length){for(var _0x6FF5=0;_0x6FF5< _0x6F86.length;_0x6FF5++){if(_0x6F86[_0x6FF5].name== '\x74\x79\x70\x65'){if(_0x6F86[_0x6FF5].value== '\x74\x72\x75\x65'){var _0x7064='';if(_0x6F86[_0x6FF5].id== '\x66\x70\x2D\x70\x72\x69\x63\x65\x5F\x63\x68\x65\x63\x6B'){_0x7064= '\x66\x69\x78\x65\x64'}else {if(_0x6F86[_0x6FF5].id== '\x61\x75\x63\x74\x69\x6F\x6E\x5F\x63\x68\x65\x63\x6B'){_0x7064= '\x61\x75\x63\x74\x69\x6F\x6E'}else {if(_0x6F86[_0x6FF5].id== '\x6F\x66\x72\x2D\x70\x72\x69\x63\x65\x5F\x63\x68\x65\x63\x6B'){_0x7064= '\x6F\x66\x66\x65\x72'}}};_0x6FAB[_0x6F86[_0x6FF5].name]= _0x7064}}else {_0x6FAB[_0x6F86[_0x6FF5].name]= _0x6F86[_0x6FF5].value}}};_0x701A.session.draftedData= _0x6FAB;_0x703F.json(1);_0x703F.end()});app.post(['\x2F\x72\x65\x6C\x69\x73\x74\x50\x72\x6F\x64\x75\x63\x74\x54\x6F\x41\x75\x63\x74\x69\x6F\x6E'],function(_0x6FAB,_0x6FD0){var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);config.mysql.beginTransaction(function(_0x6F61){q.all([product.relistProductToAuction(_0x6FAB,config.mysql,q),product.clearProductBidHistory(_0x6FAB,config.mysql,q)]).then(function(_0x6F61){_0x6FD0.redirect('\x2F\x73\x65\x6C\x6C\x65\x72\x2F\x6F\x70\x65\x6E\x41\x75\x63\x74\x69\x6F\x6E')})})});app.post(['\x2F\x62\x75\x79\x50\x72\x6F\x64\x75\x63\x74'],function(_0x6FAB,_0x6FD0){common.checkLogin(_0x6FAB,_0x6FD0,0);var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);async.waterfall([function(_0x6F61){config.mysql.beginTransaction(function(_0x6F61){q.all([product.getProductDetails(_0x6FAB,config.mysql,q)]).then(function(_0x701A){var _0x6FF5=_0x701A[0][0][0];console.log("\x70\x72\x6F\x64\x75\x63\x74\x44\x61\x74\x61",_0x6FF5.lots_available);if(_0x6FF5.lots_available>= _0x6FAB.body.buyQty){var _0x6F86=_0x6FF5.lots_available- _0x6FAB.body.buyQty;var _0x6F61=parseFloat(_0x6FF5.buynow_price)* parseFloat(_0x6FAB.body.buyQty);data= {amount:_0x6F61,qty:_0x6FAB.body.buyQty,type:'\x42\x75\x79',paid:0,projectId:_0x6FAB.body.id};if(_0x6FF5.type== '\x66\x69\x78\x65\x64'){_0x6F61= parseFloat(_0x6FF5.fixed_price)* parseFloat(_0x6FAB.body.buyQty);data.amount= _0x6F61;data.qty= _0x6FAB.body.buyQty;product.updateBuyNow(_0x6FAB,config.mysql,q)}else {if(_0x6FF5.type== '\x6F\x66\x66\x65\x72'){_0x6F86= parseFloat(_0x6FF5.lots_available)- parseFloat(_0x6FAB.body.buyQty);_0x6F61= parseFloat(_0x6FF5.offer_price)* parseFloat(_0x6FAB.body.buyQty);data.amount= _0x6F61;data.qty= _0x6FAB.body.buyQty;product.updateBuyNowOffer(_0x6FAB,config.mysql,q)}else {product.updateBuyNow(_0x6FAB,config.mysql,q)}};product.insertBuyNowRecord(_0x6FAB,config.mysql,q,data);_0x6FAB.body.product_id= _0x6FAB.body.id;_0x6FAB.body.type= '\x42\x75\x79\x6E\x6F\x77';_0x6FAB.body.amount= _0x6F61;_0x6FAB.body.gateway= '';_0x6FAB.body.transactionid= '';_0x6FAB.body.shipping_amount= 0;_0x6FAB.body.qty= _0x6FAB.body.buyQty;product.generate_invoice(_0x6FAB,config.mysql,q);io.sockets.emit('\x64\x69\x73\x61\x62\x6C\x65\x42\x69\x64',{projectId:_0x6FAB.body.id,lots_available:_0x6F86});q.all([localm.mailtemps(_0x6FAB,config.mysql,q,'\x70\x72\x6F\x64\x75\x63\x74\x5F\x73\x6F\x6C\x64\x5F\x75\x73\x69\x6E\x67\x5F\x62\x75\x79\x6E\x6F\x77\x5F\x66\x65\x61\x74\x75\x72\x65'),product.getProductSellerDetail(_0x6FAB,config.mysql,q),localm.mailtemps(_0x6FAB,config.mysql,q,'\x73\x65\x6E\x64\x5F\x74\x6F\x5F\x73\x65\x6C\x6C\x65\x72\x5F\x61\x75\x63\x74\x69\x6F\x6E\x5F\x63\x6F\x6E\x76\x65\x72\x74\x65\x64\x5F\x74\x6F\x5F\x62\x75\x79\x6E\x6F\x77')]).then(function(_0x6F86){console.log('\x70\x72\x6F\x64\x75\x63\x74\x5F\x73\x6F\x6C\x64\x5F\x75\x73\x69\x6E\x67\x5F\x62\x75\x79\x6E\x6F\x77\x5F\x66\x65\x61\x74\x75\x72\x65');if(_0x6F86[0][0].length> 0){var _0x701A=_0x6F86[0][0][0].template;var _0x6FD0=_0x6F86[0][0][0].subject;var _0x703F=config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6FAB.body.id;_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86[1][0][0].name);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x74\x69\x74\x6C\x65\x7D\x7D',_0x6F86[1][0][0].product_title);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x69\x63\x65\x7D\x7D',_0x6F61);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x703F);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x71\x74\x79\x7D\x7D',_0x6FAB.body.buyQty);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6E\x61\x6D\x65\x7D\x7D',_0x6FAB.session.name);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x701A,_0x6FD0,_0x6F86[1][0][0].email)};if(_0x6FF5.type== '\x61\x75\x63\x74\x69\x6F\x6E'){if(_0x6F86[2][0].length> 0){var _0x701A=_0x6F86[2][0][0].template;var _0x6FD0=_0x6F86[2][0][0].subject;var _0x703F=config.url+ '\x2F\x73\x65\x6C\x6C\x65\x72\x2F\x6F\x70\x65\x6E\x41\x75\x63\x74\x69\x6F\x6E';_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86[1][0][0].name);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x5F\x74\x69\x74\x6C\x65\x7D\x7D',_0x6F86[1][0][0].product_title);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x703F);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x701A,_0x6FD0,_0x6F86[1][0][0].email)}}});q.all([localm.mailtemps(_0x6FAB,config.mysql,q,'\x79\x6F\x75\x5F\x68\x61\x76\x65\x5F\x70\x75\x72\x63\x68\x61\x73\x65\x64\x5F\x75\x73\x69\x6E\x67\x5F\x62\x75\x79\x6E\x6F\x77\x5F\x66\x65\x61\x74\x75\x72\x65'),product.getProductSellerDetail(_0x6FAB,config.mysql,q)]).then(function(_0x6F86){console.log('\x79\x6F\x75\x5F\x68\x61\x76\x65\x5F\x70\x75\x72\x63\x68\x61\x73\x65\x64\x5F\x75\x73\x69\x6E\x67\x5F\x62\x75\x79\x6E\x6F\x77\x5F\x66\x65\x61\x74\x75\x72\x65');if(_0x6F86[0][0].length> 0){var _0x6FF5=_0x6F86[0][0][0].template;var _0x6FD0=_0x6F86[0][0][0].subject;var _0x701A=config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6FAB.body.id;_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FAB.session.name);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x74\x69\x74\x6C\x65\x7D\x7D',_0x6F86[1][0][0].product_title);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x61\x6D\x6F\x75\x6E\x74\x7D\x7D',_0x6F61);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x701A);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FF5,_0x6FD0,_0x6FAB.session.email)}});config.mysql.commit(function(_0x6F61){console.log("\x77\x61\x74\x65\x72\x66\x61\x6C\x6C\x5F\x31\x20\x43\x6F\x6D\x6D\x69\x74\x65\x64")});_0x6FD0.send({status:'\x62\x75\x79\x5F\x73\x75\x63\x63\x65\x73\x73',lots_available:_0x6F86})}else {_0x6FD0.send({status:'\x62\x75\x79\x5F\x65\x72\x72\x6F\x72'})}})})}])});app.post(['\x2F\x73\x61\x76\x65','\x2F\x73\x61\x76\x65\x2F\x3A\x69\x64'],function(_0x6F61,_0x6F86){$arr.id= _0x6F61.body.product_id;_0x6F61.body.loggedUserId= _0x6F61.session.userid?_0x6F61.session.userid:0;if(_0x6F61.body.loggedUserId!= ""&& _0x6F61.body.loggedUserId!= 0){if(_0x6F61.body.product_id!= 0){q.all([product.updateProduct(_0x6F61,_0x6F86,config.mysql,q)]).then(function(_0x703F){var _0x6FF5=_0x6F61.body.product_id;var _0x7064=_0x6F61.body.loggedUserId;if( typeof (_0x6F61.body.videoUrl)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x7089=_0x6F61.body.videoUrl;if(_0x7089.length> 0){product.deleteProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FF5,'\x76\x69\x64\x65\x6F');for(var _0x6FD0=0;_0x6FD0< _0x7089.length;_0x6FD0++){product.saveProductVideoUrl(_0x6F61,_0x6F86,config.mysql,q,_0x7089[_0x6FD0],_0x6FF5)}}};if( typeof (_0x6F61.body.productDocument)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x701A=_0x6F61.body.productDocument;for(var _0x6FD0=0;_0x6FD0< _0x701A.length;_0x6FD0++){if(!_0x701A[_0x6FD0].id){product.saveProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x701A[_0x6FD0],_0x6FF5)}}};if( typeof (_0x6F61.body.certificatesDocument)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x6FAB=_0x6F61.body.certificatesDocument;for(var _0x6FD0=0;_0x6FD0< _0x6FAB.length;_0x6FD0++){product.savecertificatesDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FAB[_0x6FD0],_0x6FF5,_0x7064)}};io.sockets.emit('\x65\x6E\x64\x5F\x64\x61\x74\x65\x5F\x63\x68\x61\x6E\x67\x65',{product_id:_0x6F61.body.product_id,end_date:_0x6F61.body.end_date});if(_0x6F61.body.action== '\x72\x65\x6C\x69\x73\x74'){_0x6F61.body.id= _0x6F61.body.product_id;q.all([product.getBidHistory(_0x6F61,config.mysql,q),localm.mailtemps(_0x6F61,config.mysql,q,'\x73\x65\x6E\x64\x5F\x74\x6F\x5F\x62\x75\x79\x65\x72\x73\x5F\x61\x75\x63\x74\x69\x6F\x6E\x5F\x72\x65\x6C\x69\x73\x74\x65\x64')]).then(function(_0x6FD0){product.clearProductBidHistory(_0x6F61,config.mysql,q);for(var _0x6FAB=0;_0x6FAB< _0x6FD0[0][0].length;_0x6FAB++){var _0x6F86=_0x6FD0[0][0][_0x6FAB];if(_0x6FD0[1][0].length> 0){var _0x701A=_0x6FD0[1][0][0].template;var _0x6FF5=_0x6FD0[1][0][0].subject;var _0x703F=config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F61.body.id;_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86.name);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x5F\x74\x69\x74\x6C\x65\x7D\x7D',_0x6F61.body.title);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x703F);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x701A,_0x6FF5,_0x6F86.email)}}})};_0x6F86.json({status:200,success:true,message:'\x73\x75\x63\x63\x65\x73\x73',result:_0x703F[0][0].insertId});_0x6F86.end()}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}else {q.all([product.saveProduct(_0x6F61,_0x6F86,config.mysql,q)]).then(function(_0x703F){var _0x6FF5=_0x703F[0][0].insertId;var _0x7064=0;_0x6F61.body.product_id= _0x6FF5;product.saveProductToSEO(_0x6F61,config.mysql,q);if( typeof (_0x6F61.body.videoUrl)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x7089=_0x6F61.body.videoUrl;if(_0x7089.length> 0){for(var _0x6FD0=0;_0x6FD0< _0x7089.length;_0x6FD0++){product.saveProductVideoUrl(_0x6F61,_0x6F86,config.mysql,q,_0x7089[_0x6FD0],_0x6FF5)}}};console.log("\x69\x6E\x20\x53\x41\x76\x65\x20\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x73");var _0x701A=_0x6F61.body.productDocument;for(var _0x6FD0=0;_0x6FD0< _0x701A.length;_0x6FD0++){if(!_0x701A[_0x6FD0].id){product.saveProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x701A[_0x6FD0],_0x6FF5)}};var _0x6FAB=_0x6F61.body.certificatesDocument;for(var _0x6FD0=0;_0x6FD0< _0x6FAB.length;_0x6FD0++){product.savecertificatesDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FAB[_0x6FD0],_0x6FF5,_0x7064)};q.all([localm.mailtemps(_0x6F61,config.mysql,q,'\x70\x72\x6F\x64\x75\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')]).then(function(_0x6F86){console.log('\x70\x72\x6F\x64\x75\x63\x74\x5F\x70\x6F\x73\x74\x65\x64');if(_0x6F86[0][0].length> 0){var _0x6FD0=_0x6F86[0][0][0].template;var _0x6FAB=_0x6F86[0][0][0].subject;_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F61.session.name);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x6F61.body.view_url);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FD0,_0x6FAB,_0x6F61.session.email)}});q.all([localm.mailtemps(_0x6F61,config.mysql,q,'\x70\x72\x6F\x64\x75\x63\x74\x5F\x70\x6F\x73\x74\x65\x64\x5F\x6C\x69\x76\x65')]).then(function(_0x6F86){console.log('\x70\x72\x6F\x64\x75\x63\x74\x5F\x70\x6F\x73\x74\x65\x64\x5F\x6C\x69\x76\x65');if(_0x6F86[0][0].length> 0){var _0x6FD0=_0x6F86[0][0][0].template;var _0x6FAB=_0x6F86[0][0][0].subject;_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F61.session.name);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FD0,_0x6FAB,_0x6F61.session.email)}});_0x6F86.json({status:200,success:true,message:'\x73\x75\x63\x63\x65\x73\x73',result:_0x703F[0][0].insertId});_0x6F86.end()}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}}else {_0x6F86.json({status:302,success:false,message:'\x73\x65\x73\x73\x69\x6F\x6E\x5F\x65\x78\x70\x69\x72\x65\x64'});_0x6F86.end()}});app.post('\x2F\x73\x61\x76\x65\x31',function(_0x6F86,_0x6FAB){common.checkLogin(_0x6F86,_0x6FAB,0);$arr.error= '';var _0x6F61=require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x61\x74\x74\x61\x63\x68');_0x6F61.save('\x70\x72\x6F\x64\x75\x63\x74',_0x6F86,_0x6FAB);q.all([product.save(_0x6F86,_0x6FAB,config.mysql,q),product.checkmailnotify(_0x6F86,config.mysql,q,3),product.checksmsnotify(_0x6F86,config.mysql,q,3)]).then(function(_0x6F61){localm= require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x6C\x6F\x63\x61\x6C\x6D\x61\x69\x6C');if(_0x6F61[1][0].length> 0){if(global.emaillocal.status== '\x79\x65\x73'){q.all([localm.mailtemps(_0x6F86,config.mysql,q,'\x70\x72\x6F\x6A\x65\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')]).then(function(_0x6FAB){if(_0x6FAB){var _0x6FF5=_0x6FAB[0][0][0].template;var _0x6FD0=_0x6FAB[0][0][0].subject;_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x69\x74\x65\x6E\x61\x6D\x65\x7D\x7D',"\x41\x75\x63\x74\x69\x6F\x6E\x20\x53\x6F\x66\x74\x77\x61\x72\x65\x2E\x63\x6F\x6D");_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86.session.first_name+ '\x20'+ _0x6F86.session.last_name);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6E\x61\x6D\x65\x7D\x7D',_0x6F86.body.title);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F61[0].insertId);localm.sendmail(_0x6FF5,_0x6FD0,_0x6F86.session.email)}else {console.log('\x4E\x6F\x20\x74\x65\x6D\x70\x6C\x61\x74\x65\x20\x6E\x61\x6D\x65\x64\x20\x70\x72\x6F\x6A\x65\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')}})}else {console.log('\x4E\x6F\x20\x4D\x61\x69\x6C\x20\x44\x65\x6C\x69\x76\x65\x72\x79\x20\x6D\x65\x74\x68\x6F\x64\x20\x69\x73\x20\x73\x65\x6C\x65\x63\x74\x65\x64')}}else {console.log('\x45\x6D\x61\x69\x6C\x20\x6D\x65\x74\x68\x6F\x64\x20\x69\x73\x20\x6E\x6F\x74\x20\x53\x65\x6C\x65\x63\x74\x65\x64\x20\x66\x6F\x72\x20\x70\x72\x6F\x64\x75\x63\x74\x20\x70\x6F\x73\x74\x69\x6E\x67')};if(_0x6F61[2][0].length> 0){if(global.smstwo.status== '\x79\x65\x73'){twillio= require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x74\x77\x69\x6C\x6C\x69\x6F');q.all([twillio.smstemps(_0x6F86,config.mysql,q,'\x70\x72\x6F\x6A\x65\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')]).then(function(_0x6F61){if(_0x6F61){var _0x6FAB=_0x6F61[0][0][0].template;_0x6FAB= _0x6FAB.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x69\x74\x65\x6E\x61\x6D\x65\x7D\x7D',"\x41\x75\x63\x74\x69\x6F\x6E\x20\x53\x6F\x66\x74\x77\x61\x72\x65\x2E\x63\x6F\x6D");_0x6FAB= _0x6FAB.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86.session.first_name+ '\x20'+ _0x6F86.session.last_name);_0x6FAB= _0x6FAB.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6E\x61\x6D\x65\x7D\x7D',_0x6F86.body.title);_0x6FAB= _0x6FAB.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F86.body.p_id);twillio.sendsms(_0x6FAB,_0x6F86.session.phone)}else {console.log('\x4E\x6F\x20\x74\x65\x6D\x70\x6C\x61\x74\x65\x20\x6E\x61\x6D\x65\x20\x70\x72\x6F\x6A\x65\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')}})}}else {console.log('\x53\x4D\x53\x20\x6D\x65\x74\x68\x6F\x64\x20\x6E\x6F\x74\x20\x73\x65\x6C\x65\x63\x74\x65\x64\x20\x66\x6F\x72\x20\x70\x72\x6F\x6A\x65\x63\x74\x5F\x70\x6F\x73\x74\x65\x64')};_0x6FAB.writeHead(302,{'\x4C\x6F\x63\x61\x74\x69\x6F\x6E':'\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x6D\x79'});_0x6FAB.end();return false})});app["\x67\x65\x74"](['\x2F\x76\x69\x65\x77\x2F','\x2F\x76\x69\x65\x77\x2F\x3A\x69\x64','\x2F\x62\x69\x64\x2F\x3A\x70\x69\x64','\x2F\x62\x75\x79\x6E\x6F\x77\x2F\x3A\x73\x69\x64','\x2F\x76\x69\x65\x77\x2F\x3A\x69\x64\x2F\x3A\x65\x72\x72\x6F\x72','\x2F\x76\x69\x65\x77\x2F\x3A\x69\x64\x2F\x3A\x74\x79\x70\x65\x2F\x3A\x74\x69\x74\x6C\x65'],function(_0x6F61,_0x6F86){$arr['\x70\x61\x67\x65\x5F\x6E\x61\x6D\x65']= '\x70\x72\x6F\x64\x75\x63\x74\x5F\x76\x69\x65\x77';_0x6F61.body.id= _0x6F61.param('\x69\x64');_0x6F61.body.productId= _0x6F61.param('\x69\x64');_0x6F61.body.product_id= _0x6F61.body.productId;$arr['\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70']= _0x6F61.param('\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70')?_0x6F61.param('\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70'):'';_0x6F61.body.type= _0x6F61.param('\x74\x79\x70\x65');_0x6F61.body.title= _0x6F61.param('\x74\x69\x74\x6C\x65');if(!_0x6F61.body.type||  !_0x6F61.body.title){q.all([product.getProductDetails(_0x6F61,config.mysql,q)]).then(function(_0x6FAB){_0x6F86.redirect('\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F61.body.id+ '\x2F'+ encodeURI(_0x6FAB[0][0][0].type)+ '\x2F'+ encodeURI(_0x6FAB[0][0][0].title)+ ($arr['\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70']!= ''?'\x3F\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70\x3D'+ encodeURI($arr['\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70']):''))})};q.all([product.getProductDetails(_0x6F61,config.mysql,q),product.getProductImages(_0x6F61,config.mysql,q),product.getBidHistory(_0x6F61,config.mysql,q),product.getWatchlist(_0x6F61,config.mysql,q),product.get_buyer_unread_offer_chat(_0x6F61,config.mysql,q),product.getProductCertificate(_0x6F61,config.mysql,q)]).then(function(_0x7064){$arr['\x75\x6E\x72\x65\x61\x64\x5F\x63\x6F\x75\x6E\x74']= 0;if(_0x7064[4][0].length){$arr['\x75\x6E\x72\x65\x61\x64\x5F\x63\x6F\x75\x6E\x74']= _0x7064[4][0][0].unread_count};$arr['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x73']= _0x7064[5][0];if(_0x7064[0][0].length<= 0){_0x6F86.redirect('\x2F\x68\x6F\x6D\x65')};console.log('\x50\x72\x6F\x64\x75\x63\x74\x20\x44\x65\x74\x61\x69\x6C\x73',_0x7064[0][1].length);$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']= _0x7064[0][0][0];$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']= _0x7064[0][0][0];$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x6E\x65\x78\x74\x5F\x62\x69\x64\x5F\x61\x6D\x6F\x75\x6E\x74']= $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x77\x69\x6E\x5F\x70\x72\x69\x63\x65']< $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x73\x74\x61\x72\x74\x5F\x70\x72\x69\x63\x65']?$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x73\x74\x61\x72\x74\x5F\x70\x72\x69\x63\x65']:$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x77\x69\x6E\x5F\x70\x72\x69\x63\x65']+ 1;$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x63\x6C\x6F\x73\x65\x64']= $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x65\x6E\x64\x5F\x64\x61\x74\x65'];var _0x701A=_0x7064[1][0];for(var _0x6FF5=0;_0x6FF5< _0x701A.length;_0x6FF5++){if(_0x701A[_0x6FF5].type== '\x76\x69\x64\x65\x6F'){_0x701A[_0x6FF5].image= _0x701A[_0x6FF5].image.replace('\x77\x61\x74\x63\x68\x3F\x76\x3D','\x65\x6D\x62\x65\x64\x2F');_0x701A[_0x6FF5].avatar= _0x701A[_0x6FF5].avatar.replace('\x77\x61\x74\x63\x68\x3F\x76\x3D','\x65\x6D\x62\x65\x64\x2F');if(_0x701A[_0x6FF5].image.match("\x79\x6F\x75\x74\x75\x2E\x62\x65")){_0x701A[_0x6FF5].image= "\x68\x74\x74\x70\x73\x3A\x2F\x2F\x77\x77\x77\x2E\x79\x6F\x75\x74\x75\x62\x65\x2E\x63\x6F\x6D\x2F\x65\x6D\x62\x65\x64\x2F"+ _0x701A[_0x6FF5].image.split("\x79\x6F\x75\x74\x75\x2E\x62\x65\x2F")[1];_0x701A[_0x6FF5].avatar= "\x68\x74\x74\x70\x73\x3A\x2F\x2F\x77\x77\x77\x2E\x79\x6F\x75\x74\x75\x62\x65\x2E\x63\x6F\x6D\x2F\x65\x6D\x62\x65\x64\x2F"+ _0x701A[_0x6FF5].avatar.split("\x79\x6F\x75\x74\x75\x2E\x62\x65\x2F")[1]};if(_0x701A[_0x6FF5].image.match("\x68\x74\x74\x70\x73\x3A\x2F\x2F\x76\x69\x6D\x65\x6F\x2E\x63\x6F\x6D")){_0x701A[_0x6FF5].image= "\x68\x74\x74\x70\x73\x3A\x2F\x2F\x70\x6C\x61\x79\x65\x72\x2E\x76\x69\x6D\x65\x6F\x2E\x63\x6F\x6D\x2F\x76\x69\x64\x65\x6F\x2F"+ _0x701A[_0x6FF5].image.split("\x68\x74\x74\x70\x73\x3A\x2F\x2F\x76\x69\x6D\x65\x6F\x2E\x63\x6F\x6D\x2F")[1];_0x701A[_0x6FF5].avatar= "\x68\x74\x74\x70\x73\x3A\x2F\x2F\x70\x6C\x61\x79\x65\x72\x2E\x76\x69\x6D\x65\x6F\x2E\x63\x6F\x6D\x2F\x76\x69\x64\x65\x6F\x2F"+ _0x701A[_0x6FF5].avatar.split("\x68\x74\x74\x70\x73\x3A\x2F\x2F\x76\x69\x6D\x65\x6F\x2E\x63\x6F\x6D\x2F")[1]};console.log('\x69\x6D\x61\x67\x65\x73\x5B\x69\x5D\x2E\x69\x6D\x61\x67\x65',_0x701A[_0x6FF5].image)}};$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']['\x70\x72\x6F\x64\x75\x63\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74']= _0x701A;$arr['\x62\x69\x64\x48\x69\x73\x74\x6F\x72\x79']= _0x7064[2][0];$arr['\x63\x75\x72\x72\x65\x6E\x74\x55\x73\x65\x72']= _0x6F61.session.userid?_0x6F61.session.userid:-1;$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']['\x77\x61\x74\x63\x68\x6C\x69\x73\x74\x46\x6C\x61\x67']= _0x7064[3][0];var _0x6FAB=[{value:'\x63\x65\x72\x74\x69\x66\x69\x65\x64\x5F\x6F\x72\x67\x61\x6E\x69\x63',text:'\x43\x65\x72\x74\x69\x66\x69\x65\x64\x20\x4F\x72\x67\x61\x6E\x69\x63'},{value:'\x67\x6D\x70',text:'\x47\x4D\x50'},{value:'\x69\x73\x6F',text:'\x49\x53\x4F'},{value:'\x6B\x6F\x73\x68\x65\x72',text:'\x4B\x6F\x73\x68\x65\x72'},{value:'\x73\x71\x66',text:'\x53\x51\x46'},{value:'\x66\x64\x61\x5F\x72\x65\x67\x69\x73\x74\x65\x72\x65\x64',text:'\x46\x44\x41\x20\x52\x65\x67\x69\x73\x74\x65\x72\x65\x64'},{value:'\x6F\x75\x74\x64\x6F\x6F\x72',text:'\x4F\x75\x74\x64\x6F\x6F\x72'},{value:'\x69\x6E\x64\x6F\x6F\x72',text:'\x49\x6E\x64\x6F\x6F\x72'},{value:'\x67\x72\x65\x65\x6E\x68\x6F\x75\x73\x65',text:'\x47\x72\x65\x65\x6E\x68\x6F\x75\x73\x65'},{value:'\x6C\x69\x67\x68\x74\x5F\x64\x65\x70\x72\x69\x76\x61\x74\x69\x6F\x6E',text:'\x4C\x69\x67\x68\x74\x20\x44\x65\x70\x72\x69\x76\x61\x74\x69\x6F\x6E'},{value:'\x63\x6F\x32',text:'\x43\x4F\x32'},{value:'\x65\x74\x68\x61\x6E\x6F\x6C',text:'\x45\x74\x68\x61\x6E\x6F\x6C'},{value:'\x68\x79\x64\x72\x6F\x63\x61\x72\x62\x6F\x6E\x5F\x65\x78\x74\x72\x61\x63\x74\x69\x6F\x6E',text:'\x48\x79\x64\x72\x6F\x63\x61\x72\x62\x6F\x6E\x20\x45\x78\x74\x72\x61\x63\x74\x69\x6F\x6E'},{value:'\x73\x74\x61\x74\x65\x6D\x65\x6E\x74\x5F\x6F\x66\x5F\x6F\x72\x69\x67\x69\x6E\x5F\x61\x76\x61\x69\x6C\x61\x62\x6C\x65',text:'\x53\x74\x61\x74\x65\x6D\x65\x6E\x74\x20\x6F\x66\x20\x6F\x72\x69\x67\x69\x6E\x20\x61\x76\x61\x69\x6C\x61\x62\x6C\x65'},{value:'\x73\x74\x61\x74\x65\x6D\x65\x6E\x74\x5F\x6F\x66\x5F\x63\x6F\x6D\x70\x6C\x69\x61\x6E\x63\x65\x5F\x61\x76\x61\x69\x6C\x61\x62\x6C\x65',text:'\x53\x74\x61\x74\x65\x6D\x65\x6E\x74\x20\x6F\x66\x20\x63\x6F\x6D\x70\x6C\x69\x61\x6E\x63\x65\x20\x61\x76\x61\x69\x6C\x61\x62\x6C\x65'}];var _0x6FD0=$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x5F\x74\x79\x70\x65\x73'].split('\x2C');$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x5F\x74\x79\x70\x65\x73\x5F\x61\x72\x72\x61\x79']= [];for(_0x6FF5= 0;_0x6FF5< _0x6FD0.length;_0x6FF5++){if(_0x6FD0[_0x6FF5]!= ''){var _0x703F=_0x6FAB.findIndex(function(_0x6F61){return _0x6F61.value== _0x6FD0[_0x6FF5]});$arr['\x70\x72\x65\x76\x69\x65\x77\x44\x61\x74\x61']['\x63\x65\x72\x74\x69\x66\x69\x63\x61\x74\x65\x5F\x74\x79\x70\x65\x73\x5F\x61\x72\x72\x61\x79'].push(_0x6FAB[_0x703F])}};for(_0x6FF5= 0;_0x6FF5< $arr.bidHistory.length;_0x6FF5++){$arr.bidHistory[_0x6FF5]['\x75\x73\x65\x72\x6E\x61\x6D\x65']= $arr.bidHistory[_0x6FF5]['\x75\x73\x65\x72\x6E\x61\x6D\x65'][0]+ "\x2A\x2A\x2A"+ $arr.bidHistory[_0x6FF5]['\x75\x73\x65\x72\x6E\x61\x6D\x65'][$arr.bidHistory[_0x6FF5]['\x75\x73\x65\x72\x6E\x61\x6D\x65'].length- 1];$arr.bidHistory[_0x6FF5]['\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74']= dateFormat( new Date($arr.bidHistory[_0x6FF5]['\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74']),"\x79\x79\x79\x79\x2D\x6D\x6D\x2D\x64\x64\x20\x68\x68\x3A\x4D\x4D\x3A\x73\x73\x20\x54\x54")};console.log("\x24\x61\x72\x72\x5B\x27\x70\x72\x6F\x6A\x65\x63\x74\x73\x27\x5D\x5B\x27\x6E\x65\x78\x74\x5F\x62\x69\x64\x5F\x61\x6D\x6F\x75\x6E\x74\x27\x5D",$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x6E\x65\x78\x74\x5F\x62\x69\x64\x5F\x61\x6D\x6F\x75\x6E\x74'],$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x77\x69\x6E\x5F\x70\x72\x69\x63\x65'],$arr['\x70\x72\x6F\x6A\x65\x63\x74\x73']['\x73\x74\x61\x72\x74\x5F\x70\x72\x69\x63\x65']);var _0x70AE='\x20\x41\x4E\x44\x20\x70\x72\x6F\x64\x75\x63\x74\x73\x2E\x63\x61\x74\x65\x67\x6F\x72\x79\x5F\x69\x64\x3D'+ $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73'].category_id+ '\x20\x41\x4E\x44\x20\x70\x72\x6F\x64\x75\x63\x74\x73\x2E\x73\x75\x62\x63\x61\x74\x65\x67\x6F\x72\x79\x5F\x69\x64\x3D'+ $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73'].subcategory_id+ '\x20\x41\x4E\x44\x20\x70\x72\x6F\x64\x75\x63\x74\x73\x2E\x69\x64\x20\x21\x3D\x20'+ _0x6F61.body.id;var _0x7089='\x20\x41\x4E\x44\x20\x70\x72\x6F\x64\x75\x63\x74\x73\x2E\x63\x61\x74\x65\x67\x6F\x72\x79\x5F\x69\x64\x3D'+ $arr['\x70\x72\x6F\x6A\x65\x63\x74\x73'].category_id+ '\x20\x41\x4E\x44\x20\x70\x72\x6F\x64\x75\x63\x74\x73\x2E\x69\x64\x20\x21\x3D\x20'+ _0x6F61.body.id;_0x6F61.body.seller_id= _0x7064[0][0][0].user_id;q.all([product.getSimilarProduct(_0x6F61,config.mysql,q,_0x70AE),product.getSimilarProduct(_0x6F61,config.mysql,q,_0x7089),product.get_seller_rattings(_0x6F61,config.mysql,q),product.get_seller_average_rattings(_0x6F61,config.mysql,q)]).then(function(_0x6FAB){$arr['\x73\x69\x6D\x69\x6C\x61\x72\x50\x72\x6F\x64\x75\x63\x74']= _0x6FAB[0][0];$arr['\x72\x61\x74\x69\x6E\x67\x73']= _0x6FAB[2][0];$arr['\x61\x76\x65\x72\x61\x67\x65\x5F\x72\x61\x74\x69\x6E\x67']= 0;if(_0x6FAB[3][0].length){$arr['\x61\x76\x65\x72\x61\x67\x65\x5F\x72\x61\x74\x69\x6E\x67']= _0x6FAB[3][0][0].average_rating};if(_0x6FAB[0][0].length< 1){$arr['\x73\x69\x6D\x69\x6C\x61\x72\x50\x72\x6F\x64\x75\x63\x74']= _0x6FAB[1][0]};common.tplFile('\x68\x6D\x62\x5F\x70\x72\x6F\x64\x75\x63\x74\x5F\x76\x69\x65\x77\x2E\x74\x70\x6C');common.headerSet(1);common.loadTemplateHeader(_0x6F61,_0x6F86,$arr)})})});app.post('\x2F\x70\x6C\x61\x63\x65\x42\x69\x64',function(_0x6FAB,_0x6FD0){if(common.checkLoginajax(_0x6FAB,_0x6FD0,0)){var _0x6F86=require('\x75\x74\x69\x6C')._extend;var _0x6F61=_0x6F86({},$arr);bids= require('\x2E\x2E\x2F\x6D\x6F\x64\x75\x6C\x65\x2F\x62\x69\x64');console.log(_0x6FAB.session,"\x73\x73\x73\x73\x73");async.waterfall([function(_0x6F61){config.mysql.beginTransaction(function(_0x6F86){q.all([product.getProductDetails(_0x6FAB,config.mysql,q)]).then(function(_0x701A){var _0x6FF5=_0x701A[0][0][0];var _0x6F86={};if(parseInt(_0x6FAB.body.enteramount)< parseInt(_0x6FF5.win_price)){_0x6F86.bpop_cbidder= _0x6FAB.session.userid?_0x6FAB.session.userid:1;_0x6F86.id= _0x6FAB.body.id;_0x6F86.status= '\x66\x61\x69\x6C\x65\x64';_0x6F86.error= '\x77\x69\x6E\x62\x69\x64\x5F\x72\x65\x73\x74\x72\x69\x63\x74\x69\x6F\x6E';_0x6F86.bpop_error= '\x77\x69\x6E\x62\x69\x64\x5F\x72\x65\x73\x74\x72\x69\x63\x74\x69\x6F\x6E';_0x6F86.message= '\x50\x6C\x65\x61\x73\x65\x20\x45\x6E\x74\x65\x72\x20\x41\x6D\x6F\x75\x6E\x74\x20\x24'+ _0x6FF5.win_price+ '\x20\x6F\x72\x20\x4D\x6F\x72\x65';console.log('\x66\x69\x6E\x61\x6C\x72\x65\x73\x75\x6C\x74\x73\x20\x32',_0x6F86);io.sockets.emit('\x62\x69\x64\x4D\x65\x73\x73\x61\x67\x65',_0x6F86);_0x6FD0.end();return false};config.mysql.commit(function(_0x6F61){console.log("\x77\x61\x74\x65\x72\x66\x61\x6C\x6C\x5F\x31\x20\x43\x6F\x6D\x6D\x69\x74\x65\x64")});_0x6F61(null,'\x63\x61\x6C\x6C\x70\x61\x73\x73')})})},function(_0x6F86,_0x6F61){config.mysql.beginTransaction(function(_0x6F86){q.all([product.placeBid(_0x6FAB,config.mysql,q),product.updateWinPrice(_0x6FAB,config.mysql,q),product.getBidHistory(_0x6FAB,config.mysql,q),product.getProductSellerDetail(_0x6FAB,config.mysql,q)]).then(function(_0x6FF5){_0x6FAB.body.enteramount= parseInt(_0x6FAB.body.enteramount);var _0x6F86={};_0x6F86.bpop_cbidder= _0x6FAB.session.userid?_0x6FAB.session.userid:1;_0x6F86.id= _0x6FAB.body.id;_0x6F86.status= '\x73\x75\x63\x63\x65\x73\x73';_0x6F86.error= '\x77\x69\x6E\x62\x69\x64\x5F\x73\x75\x63\x63\x65\x73\x73';_0x6F86.bpop_error= '\x77\x69\x6E\x62\x69\x64\x5F\x73\x75\x63\x63\x65\x73\x73';_0x6F86.next_bid_amount= _0x6FAB.body.enteramount+ 1;_0x6F86.last_bid= _0x6FAB.body.enteramount;_0x6F86.message= '\x42\x69\x64\x20\x50\x6C\x61\x63\x65\x64\x20\x53\x75\x63\x63\x65\x73\x66\x75\x6C\x6C\x79\x20\x66\x6F\x72\x20\x24'+ _0x6FAB.body.enteramount;_0x6F86.bidHistory= _0x6FF5[2][0];for(i= 0;i< _0x6F86.bidHistory.length;i++){_0x6F86.bidHistory[i]['\x75\x73\x65\x72\x6E\x61\x6D\x65']= _0x6F86.bidHistory[i]['\x75\x73\x65\x72\x6E\x61\x6D\x65'][0]+ "\x2A\x2A\x2A"+ _0x6F86.bidHistory[i]['\x75\x73\x65\x72\x6E\x61\x6D\x65'][_0x6F86.bidHistory[i]['\x75\x73\x65\x72\x6E\x61\x6D\x65'].length- 1];_0x6F86.bidHistory[i]['\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74']= dateFormat( new Date(_0x6F86.bidHistory[i]['\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74']),"\x79\x79\x79\x79\x2D\x6D\x6D\x2D\x64\x64\x20\x68\x68\x3A\x4D\x4D\x3A\x73\x73\x20\x54\x54")};console.log('\x66\x69\x6E\x61\x6C\x72\x65\x73\x75\x6C\x74\x73\x20\x32',_0x6F86);io.sockets.emit('\x62\x69\x64\x4D\x65\x73\x73\x61\x67\x65',_0x6F86);config.mysql.commit(function(_0x6F61){console.log("\x77\x61\x74\x65\x72\x66\x61\x6C\x6C\x5F\x31\x20\x43\x6F\x6D\x6D\x69\x74\x65\x64")});var _0x701A=config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6FAB.body.id;q.all([localm.mailtemps(_0x6FAB,config.mysql,q,'\x73\x6F\x6D\x65\x6F\x6E\x65\x5F\x62\x69\x64\x5F\x6F\x6E\x5F\x79\x6F\x75\x72\x5F\x69\x74\x65\x6D')]).then(function(_0x6F61){console.log('\x73\x6F\x6D\x65\x6F\x6E\x65\x5F\x62\x69\x64\x5F\x6F\x6E\x5F\x79\x6F\x75\x72\x5F\x69\x74\x65\x6D');if(_0x6F61[0][0].length> 0){var _0x6FD0=_0x6F61[0][0][0].template;var _0x6F86=_0x6F61[0][0][0].subject;_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FF5[3][0][0].name);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x74\x69\x74\x6C\x65\x7D\x7D',_0x6FF5[3][0][0].product_title);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x61\x6D\x6F\x75\x6E\x74\x7D\x7D',_0x6FAB.body.enteramount);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x701A);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FD0,_0x6F86,_0x6FF5[3][0][0].email)}});q.all([localm.mailtemps(_0x6FAB,config.mysql,q,'\x79\x6F\x75\x5F\x62\x69\x64\x5F\x70\x6C\x61\x63\x65\x64')]).then(function(_0x6F61){console.log('\x79\x6F\x75\x5F\x62\x69\x64\x5F\x70\x6C\x61\x63\x65\x64');if(_0x6F61[0][0].length> 0){var _0x6FD0=_0x6F61[0][0][0].template;var _0x6F86=_0x6F61[0][0][0].subject;_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FAB.session.name);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x74\x69\x74\x6C\x65\x7D\x7D',_0x6FF5[3][0][0].product_title);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x61\x6D\x6F\x75\x6E\x74\x7D\x7D',_0x6FAB.body.enteramount);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x4C\x69\x6E\x6B\x7D\x7D',_0x701A);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FD0,_0x6F86,_0x6FAB.session.email)}});if(_0x6FF5[2][0].length>= 1){q.all([localm.mailtemps(_0x6FAB,config.mysql,q,'\x79\x6F\x75\x5F\x68\x61\x76\x65\x5F\x62\x65\x65\x6E\x5F\x6F\x75\x74\x62\x69\x64')]).then(function(_0x6F86){console.log('\x79\x6F\x75\x5F\x68\x61\x76\x65\x5F\x62\x65\x65\x6E\x5F\x6F\x75\x74\x62\x69\x64');if(_0x6F86[0][0].length> 0){var _0x703F=_0x6F86[0][0][0].template;var _0x6FD0=_0x6F86[0][0][0].subject;var _0x6F61='\x3C\x61\x20\x68\x72\x65\x66\x3D\x22'+ _0x701A+ '\x22\x3E\x63\x6C\x69\x63\x6B\x48\x65\x72\x65\x3C\x2F\x61\x3E';_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FF5[2][0][1].name);_0x703F= _0x703F.replace('\x7B\x7B\x70\x72\x6F\x64\x75\x63\x74\x4E\x61\x6D\x65\x7D\x7D',_0x6FF5[3][0][0].product_title);_0x703F= _0x703F.replace('\x7B\x7B\x6E\x65\x77\x42\x69\x64\x50\x72\x69\x63\x65\x7D\x7D',_0x6FAB.body.enteramount);_0x703F= _0x703F.replace('\x7B\x7B\x63\x6C\x69\x63\x6B\x48\x65\x72\x65\x7D\x7D',_0x6F61);_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x703F,_0x6FD0,_0x6FF5[2][0][1].email)}})};_0x6F61(null,'\x63\x61\x6C\x6C\x70\x61\x73\x73');_0x6FD0.end()})})}])}else {_0x6FD0.send({status:'\x6C\x6F\x67\x69\x6E\x5F\x65\x72\x72\x6F\x72'})}});app.post(['\x2F\x73\x61\x76\x65\x50\x72\x6F\x64\x75\x63\x74\x54\x6F\x44\x72\x61\x66\x74','\x2F\x73\x61\x76\x65\x50\x72\x6F\x64\x75\x63\x74\x54\x6F\x44\x72\x61\x66\x74\x2F\x3A\x69\x64'],function(_0x6F61,_0x6F86){$arr.id= _0x6F61.body.product_id;_0x6F61.body.loggedUserId= _0x6F61.session.userid?_0x6F61.session.userid:0;if(_0x6F61.body.loggedUserId!= ""&& _0x6F61.body.loggedUserId!= 0){if(_0x6F61.body.product_id!= 0){q.all([product.updateDraftProduct(_0x6F61,_0x6F86,config.mysql,q)]).then(function(_0x703F){var _0x6FF5=_0x6F61.body.product_id;var _0x7064=_0x6F61.body.loggedUserId;if( typeof (_0x6F61.body.videoUrl)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x7089=_0x6F61.body.videoUrl;if(_0x7089.length> 0){product.deleteProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FF5,'\x76\x69\x64\x65\x6F');for(var _0x6FD0=0;_0x6FD0< _0x7089.length;_0x6FD0++){product.saveProductVideoUrl(_0x6F61,_0x6F86,config.mysql,q,_0x7089[_0x6FD0],_0x6FF5)}}};if( typeof (_0x6F61.body.productDocument)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x701A=_0x6F61.body.productDocument;for(var _0x6FD0=0;_0x6FD0< _0x701A.length;_0x6FD0++){if(!_0x701A[_0x6FD0].id){product.saveProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x701A[_0x6FD0],_0x6FF5)}}};if( typeof (_0x6F61.body.certificatesDocument)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x6FAB=_0x6F61.body.certificatesDocument;for(var _0x6FD0=0;_0x6FD0< _0x6FAB.length;_0x6FD0++){product.savecertificatesDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FAB[_0x6FD0],_0x6FF5,_0x7064)}};_0x6F86.json({status:200,success:true,message:'\x73\x75\x63\x63\x65\x73\x73',result:_0x703F[0][0].insertId});_0x6F86.end()}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}else {q.all([product.saveProductToDraft(_0x6F61,_0x6F86,config.mysql,q)]).then(function(_0x703F){var _0x6FF5=_0x703F[0][0].insertId;var _0x7064=0;_0x6F61.body.product_id= _0x6FF5;product.saveProductToSEO(_0x6F61,config.mysql,q);if( typeof (_0x6F61.body.videoUrl)!= '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){var _0x7089=_0x6F61.body.videoUrl;if(_0x7089.length> 0){for(var _0x6FD0=0;_0x6FD0< _0x7089.length;_0x6FD0++){product.saveProductVideoUrl(_0x6F61,_0x6F86,config.mysql,q,_0x7089[_0x6FD0],_0x6FF5)}}};if(_0x6F61.body.productDocument){var _0x701A=_0x6F61.body.productDocument;for(var _0x6FD0=0;_0x6FD0< _0x701A.length;_0x6FD0++){if(!_0x701A[_0x6FD0].id){product.saveProductDocument(_0x6F61,_0x6F86,config.mysql,q,_0x701A[_0x6FD0],_0x6FF5)}}};if(_0x6F61.body.certificatesDocument){var _0x6FAB=_0x6F61.body.certificatesDocument;for(var _0x6FD0=0;_0x6FD0< _0x6FAB.length;_0x6FD0++){product.savecertificatesDocument(_0x6F61,_0x6F86,config.mysql,q,_0x6FAB[_0x6FD0],_0x6FF5,_0x7064)}};_0x6F86.json({status:200,success:true,message:'\x73\x75\x63\x63\x65\x73\x73',result:_0x703F[0][0].insertId});_0x6F86.end()}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()}}else {_0x6F86.json({status:302,success:false,message:'\x73\x65\x73\x73\x69\x6F\x6E\x5F\x65\x78\x70\x69\x72\x65\x64'});_0x6F86.end()}});app.post(['\x2F\x67\x65\x74\x5F\x6F\x66\x66\x65\x72\x5F\x63\x68\x61\x74\x73'],function(_0x6F86,_0x6FAB){var _0x6F61=_0x6F86.body.action= ( typeof (_0x6F86.param('\x61\x63\x74\x69\x6F\x6E'))=== '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64')?'\x61\x6C\x6C':_0x6F86.param('\x61\x63\x74\x69\x6F\x6E');$arr.userstatus= _0x6F61;$arr.page= _0x6F86.body.page?_0x6F86.body.page:1;_0x6F86.body.page= $arr.page;$arr.limit= _0x6F86.body.limit?_0x6F86.body.limit:200;_0x6F86.body.limit= $arr.limit;_0x6F86.body.startFrom= (_0x6F86.body.page- 1)* _0x6F86.body.limit;q.all([product.get_offer_chats(_0x6F86,config.mysql,q,0)]).then(function(_0x6F61){var _0x6FD0=[];if(_0x6F61[0][0].length){_0x6FD0= _0x6F61[0][0]};$arr.chat_list= _0x6FD0;common.tplFile('\x68\x6D\x62\x5F\x6F\x66\x66\x65\x72\x5F\x63\x68\x61\x74\x5F\x6C\x69\x73\x74\x2E\x74\x70\x6C');common.headerSet(1);common.loadTemplateHeader(_0x6F86,_0x6FAB,$arr)}).fail(function(_0x6F61){_0x6FAB.json({status:500,success:false,error:_0x6F61});_0x6FAB.end();return false}).done()});app.post(['\x2F\x67\x65\x74\x5F\x6F\x66\x66\x65\x72\x5F\x75\x73\x65\x72\x5F\x63\x68\x61\x74\x73'],function(_0x6F86,_0x6FAB){var _0x6F61=_0x6F86.body.action= ( typeof (_0x6F86.param('\x61\x63\x74\x69\x6F\x6E'))=== '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64')?'\x61\x6C\x6C':_0x6F86.param('\x61\x63\x74\x69\x6F\x6E');$arr.userstatus= _0x6F61;$arr.page= _0x6F86.body.page?_0x6F86.body.page:1;_0x6F86.body.page= $arr.page;$arr.limit= _0x6F86.body.limit?_0x6F86.body.limit:200;_0x6F86.body.limit= $arr.limit;_0x6F86.body.startFrom= (_0x6F86.body.page- 1)* _0x6F86.body.limit;q.all([product.get_offer_user_chats(_0x6F86,config.mysql,q,0)]).then(function(_0x6F61){var _0x6FD0=[];if(_0x6F61[0][0].length){_0x6FD0= _0x6F61[0][0]};$arr.user_list= _0x6FD0;common.tplFile('\x68\x6D\x62\x5F\x6F\x66\x66\x65\x72\x5F\x63\x68\x61\x74\x5F\x75\x73\x65\x72\x5F\x6C\x69\x73\x74\x2E\x74\x70\x6C');common.headerSet(1);common.loadTemplateHeader(_0x6F86,_0x6FAB,$arr)}).fail(function(_0x6F61){_0x6FAB.json({status:500,success:false,error:_0x6F61});_0x6FAB.end();return false}).done()});app.post(['\x2F\x73\x65\x6E\x64\x5F\x6F\x66\x66\x65\x72\x5F\x6D\x65\x73\x73\x61\x67\x65'],function(_0x6F61,_0x6F86){q.all([product.send_offer_message(_0x6F61,config.mysql,q,0)]).then(function(_0x6FAB){if(_0x6FAB[0][0].affectedRows){_0x6F61.body.id= _0x6FAB[0][0].insertId;q.all([product.get_offer_chats(_0x6F61,config.mysql,q,0)]).then(function(_0x6FD0){var _0x6FAB={};if(_0x6FD0[0][0].length){_0x6FAB= _0x6FD0[0][0][0]};io.sockets.emit('\x6F\x66\x66\x65\x72\x5F\x6D\x65\x73\x73\x61\x67\x65',_0x6FAB);_0x6F86.json({success:true,status:200,message:'\x6D\x65\x73\x73\x61\x67\x65\x20\x73\x65\x6E\x74\x20\x73\x75\x63\x63\x65\x73\x73',data:_0x6FAB});if(_0x6F61.body.buyer_offer> 0&& _0x6FD0[0][0].length){q.all([localm.mailtemps(_0x6F61,config.mysql,q,'\x62\x75\x79\x65\x72\x5F\x73\x65\x6E\x74\x5F\x6F\x66\x66\x65\x72\x5F\x74\x6F\x5F\x73\x65\x6C\x6C\x65\x72')]).then(function(_0x6F86){console.log('\x62\x75\x79\x65\x72\x5F\x73\x65\x6E\x74\x5F\x6F\x66\x66\x65\x72\x5F\x74\x6F\x5F\x73\x65\x6C\x6C\x65\x72');if(_0x6F86[0][0].length> 0){var _0x6FF5=_0x6F86[0][0][0].template;var _0x6FD0=_0x6F86[0][0][0].subject;var _0x701A=config.url+ '\x2F\x73\x65\x6C\x6C\x65\x72\x2F\x6F\x70\x65\x6E\x41\x75\x63\x74\x69\x6F\x6E\x3F\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70\x3D'+ _0x6F61.body.product_id;_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FAB.receiver_name);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x61\x6D\x6F\x75\x6E\x74\x7D\x7D',_0x6F61.body.buyer_offer);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x701A);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FF5,_0x6FD0,_0x6FAB.receiver_email)}})}else {q.all([localm.mailtemps(_0x6F61,config.mysql,q,'\x79\x6F\x75\x5F\x68\x61\x76\x65\x5F\x6E\x65\x77\x5F\x6D\x65\x73\x73\x61\x67\x65\x5F\x66\x72\x6F\x6D\x5F\x6F\x66\x66\x65\x72\x5F\x70\x72\x6F\x64\x75\x63\x74')]).then(function(_0x703F){var _0x701A=_0x703F[0][0][0].template;var _0x6FF5=_0x703F[0][0][0].subject;var _0x6FD0=$arr.config.spath+ '\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67';var _0x6F86=$arr.config.spath+ '\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F61.body.product_id+ '\x3F\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70\x3D'+ _0x6F61.body.product_id;if(_0x6F61.body.receiver_id== _0x6F61.body.seller_id){_0x6F86= $arr.config.spath+ '\x73\x65\x6C\x6C\x65\x72\x2F\x6F\x70\x65\x6E\x41\x75\x63\x74\x69\x6F\x6E\x3F\x63\x68\x61\x74\x5F\x70\x6F\x70\x75\x70\x3D'+ _0x6F61.body.product_id};_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x69\x74\x65\x6E\x61\x6D\x65\x7D\x7D',config.title);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FAB.receiver_name);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x6F86);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x5F\x74\x69\x74\x6C\x65\x7D\x7D',_0x6FAB.product_title);_0x701A= _0x701A.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',_0x6FD0);localm.sendmail(_0x701A,_0x6FF5,_0x6FAB.receiver_email)}).fail(function(_0x6F61){console.log(_0x6F61.stack);throw _0x6F61}).done()};_0x6F86.end();return false}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()}else {_0x6F86.json({status:500,success:false,error:err});_0x6F86.end();return false}}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()});app.post(['\x2F\x73\x75\x62\x6D\x69\x74\x5F\x66\x69\x6E\x61\x6C\x5F\x6F\x66\x66\x65\x72'],function(_0x6F61,_0x6F86){q.all([product.submit_final_offer(_0x6F61,config.mysql,q,0)]).then(function(_0x6FD0){var _0x6FF5=[];if(_0x6FD0[0][0].length){_0x6FF5= _0x6FD0[0][0]};var _0x6FAB={amount:_0x6F61.body.amount,offer_buyer_id:_0x6F61.body.offer_buyer_id,product_id:_0x6F61.body.product_id};io.sockets.emit('\x6F\x66\x66\x65\x72\x5F\x62\x75\x79\x6E\x6F\x77\x5F\x61\x63\x74\x69\x76\x61\x74\x65\x64\x5F'+ _0x6F61.body.product_id+ '\x5F'+ _0x6F61.body.offer_buyer_id,_0x6FAB);_0x6F86.json({status:200,success:true,result:{}});_0x6F61.body.userid= _0x6F61.body.offer_buyer_id;if(_0x6F61.body.userid> 0){q.all([localm.mailtemps(_0x6F61,config.mysql,q,'\x73\x65\x6C\x6C\x65\x72\x5F\x61\x63\x63\x65\x70\x74\x65\x64\x5F\x6F\x66\x66\x65\x72'),user.getUserDetail(_0x6F61,config.mysql,q,0)]).then(function(_0x6F86){console.log('\x73\x65\x6C\x6C\x65\x72\x5F\x61\x63\x63\x65\x70\x74\x65\x64\x5F\x6F\x66\x66\x65\x72');if(_0x6F86[0][0].length> 0){var _0x6FD0=_0x6F86[0][0][0].template;var _0x6FAB=_0x6F86[0][0][0].subject;var _0x6FF5=config.url+ '\x2F\x70\x72\x6F\x64\x75\x63\x74\x2F\x76\x69\x65\x77\x2F'+ _0x6F61.body.product_id;_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F86[1][0][0].name);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x61\x6D\x6F\x75\x6E\x74\x7D\x7D',_0x6F61.body.amount);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x6FF5);_0x6FD0= _0x6FD0.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');localm.sendmail(_0x6FD0,_0x6FAB,_0x6F86[1][0][0].email)}})};_0x6F86.end();return false}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()});app.post(['\x2F\x63\x68\x61\x6E\x67\x65\x5F\x70\x72\x6F\x64\x75\x63\x74\x5F\x65\x6E\x64\x5F\x64\x61\x74\x65'],function(_0x6F86,_0x6FAB){var _0x6F61=_0x6F86.body.action= ( typeof (_0x6F86.param('\x61\x63\x74\x69\x6F\x6E'))=== '\x75\x6E\x64\x65\x66\x69\x6E\x65\x64')?'\x61\x6C\x6C':_0x6F86.param('\x61\x63\x74\x69\x6F\x6E');$arr.userstatus= _0x6F61;$arr.page= _0x6F86.body.page?_0x6F86.body.page:1;_0x6F86.body.page= $arr.page;$arr.limit= _0x6F86.body.limit?_0x6F86.body.limit:200;_0x6F86.body.limit= $arr.limit;_0x6F86.body.startFrom= (_0x6F86.body.page- 1)* _0x6F86.body.limit;q.all([product.change_product_end_date(_0x6F86,config.mysql,q,0)]).then(function(_0x6F61){_0x6F86.body.end_date= dateFormat(_0x6F86.body.end_date,"\x79\x79\x79\x79\x2D\x6D\x6D\x2D\x64\x64\x20\x48\x48\x3A\x4D\x4D\x3A\x73\x73");io.sockets.emit('\x65\x6E\x64\x5F\x64\x61\x74\x65\x5F\x63\x68\x61\x6E\x67\x65',{product_id:_0x6F86.body.product_id,end_date:_0x6F86.body.end_date});var _0x6FD0=[];if(_0x6F61[0][0].length){_0x6FD0= _0x6F61[0][0][0]};_0x6FAB.json({status:200,success:true,error:_0x6FD0});_0x6FAB.end();return false}).fail(function(_0x6F61){_0x6FAB.json({status:500,success:false,error:_0x6F61});_0x6FAB.end();return false}).done()});app.post(['\x2F\x73\x65\x74\x5F\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x69\x64'],function(_0x6F61,_0x6F86){_0x6F61.body.id= _0x6F61.body.product_id;q.all([product.set_shipping_id(_0x6F61,config.mysql,q),localm.mailtemps(_0x6F61,config.mysql,q,'\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x61\x64\x64\x72\x65\x73\x73\x5F\x61\x64\x64\x65\x64\x5F\x6F\x66\x5F\x79\x6F\x75\x72\x5F\x73\x6F\x6C\x64\x5F\x70\x72\x6F\x64\x75\x63\x74'),product.getProduct(_0x6F61,config.mysql,q),user.get_shipping_details(_0x6F61,config.mysql,q)]).then(function(_0x6F61){if(_0x6F61[1][0].length> 0){var _0x6FF5=_0x6F61[1][0][0].template;var _0x6FD0=_0x6F61[1][0][0].subject;var _0x703F=config.url+ '\x2F\x73\x65\x6C\x6C\x65\x72\x2F\x73\x6F\x6C\x64\x41\x75\x63\x74\x69\x6F\x6E\x2F';var _0x6FAB=_0x6F61[3][0][0];_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6F61[2][0][0].seller_name);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x5F\x74\x69\x74\x6C\x65\x7D\x7D',_0x6F61[2][0][0].title);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x703F);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x61\x64\x64\x72\x65\x73\x73\x7D\x7D',_0x6FAB.address);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x63\x69\x74\x79\x7D\x7D',_0x6FAB.city);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x73\x74\x61\x74\x65\x7D\x7D',_0x6FAB.state);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x63\x6F\x75\x6E\x74\x72\x79\x7D\x7D',_0x6FAB.country);_0x6FF5= _0x6FF5.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x7A\x69\x70\x63\x6F\x64\x65\x7D\x7D',_0x6FAB.zipcode);localm.sendmail(_0x6FF5,_0x6FD0,_0x6F61[2][0][0].seller_email)};var _0x701A=[];if(_0x6F61[0][0].length){_0x701A= _0x6F61[0][0][0]};_0x6F86.json({status:200,success:true,result:_0x701A});_0x6F86.end();return false}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()});app.post(['\x2F\x73\x65\x74\x5F\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x61\x6D\x6F\x75\x6E\x74'],function(_0x6F61,_0x6F86){q.all([product.get_product_and_buyer_details_using_invoice(_0x6F61,config.mysql,q)]).then(function(_0x6FAB){var _0x6FD0=parseFloat(_0x6FAB[0][0][0].amount)+ parseFloat(_0x6FAB[0][0][0].transaction_fee)+ parseFloat(_0x6F61.body.shipping_amount);_0x6F61.body.status= '\x6E\x6F\x74\x5F\x70\x61\x69\x64';console.log('\x74\x6F\x74\x61\x6C\x5F\x61\x6D\x6F\x75\x6E\x74',_0x6FD0);if(_0x6FD0> 2500){_0x6F61.body.status= '\x77\x61\x69\x74\x69\x6E\x67\x5F\x66\x6F\x72\x5F\x65\x73\x63\x72\x6F\x77\x5F\x64\x65\x74\x61\x69\x6C\x73'};q.all([product.set_shipping_amount(_0x6F61,config.mysql,q),localm.mailtemps(_0x6F61,config.mysql,q,'\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x61\x6D\x6F\x75\x6E\x74\x5F\x61\x64\x64\x65\x64\x5F\x6F\x66\x5F\x79\x6F\x75\x72\x5F\x62\x75\x79\x5F\x70\x72\x6F\x64\x75\x63\x74')]).then(function(_0x6FD0){if(_0x6FD0[1][0].length> 0){var _0x703F=_0x6FD0[1][0][0].template;var _0x701A=_0x6FD0[1][0][0].subject;var _0x7089=config.url+ '\x2F\x62\x75\x79\x65\x72\x2F\x62\x75\x79\x41\x75\x63\x74\x69\x6F\x6E\x2F';var _0x6FF5='\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x69\x64\x5F'+ _0x6F61.body.invoice_id;_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x73\x65\x72\x7D\x7D',_0x6FAB[0][0][0].buyer_name);_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x70\x72\x6F\x64\x75\x63\x74\x5F\x74\x69\x74\x6C\x65\x7D\x7D',_0x6FAB[0][0][0].title);_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x69\x64\x7D\x7D',_0x6FF5);_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x75\x72\x6C\x7D\x7D',_0x7089);_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x6C\x6F\x67\x6F\x5F\x75\x72\x6C\x7D\x7D',config.url+ '\x2F\x69\x6D\x61\x67\x65\x73\x2F\x6C\x6F\x67\x6F\x2E\x70\x6E\x67');_0x703F= _0x703F.replace('\x7B\x7B\x65\x76\x65\x6E\x74\x2E\x73\x68\x69\x70\x70\x69\x6E\x67\x5F\x61\x6D\x6F\x75\x6E\x74\x7D\x7D','\x24'+ parseFloat(_0x6F61.body.shipping_amount).toFixed(2));localm.sendmail(_0x703F,_0x701A,_0x6FAB[0][0][0].buyer_email)};var _0x7064=[];if(_0x6FD0[0][0].length){_0x7064= _0x6FD0[0][0][0]};_0x6F86.json({status:200,success:true,result:_0x7064});_0x6F86.end();return false}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()}).fail(function(_0x6F61){_0x6F86.json({status:500,success:false,error:_0x6F61});_0x6F86.end();return false}).done()});app.post(['\x2F\x6D\x61\x6B\x65\x5F\x74\x72\x61\x6E\x73\x61\x63\x74\x69\x6F\x6E'],function(_0x6F86,_0x6FAB){var _0x6F61=require('\x64\x61\x74\x65\x66\x6F\x72\x6D\x61\x74');$arr.externaljs= ['\x72\x65\x67\x69\x73\x74\x65\x72','\x6A\x71\x75\x65\x72\x79\x2E\x6D\x61\x73\x6B\x2E\x6D\x69\x6E'];if(_0x6F86.body.buynow_id> 0){_0x6F86.body.id= _0x6F86.body.buynow_id;q.all([product.get_buynow_detail(_0x6F86,config.mysql,q)]).then(function(_0x6F61){_0x6F86.body.amount= _0x6F61[0][0][0].amount.toFixed(2);_0x6F86.body.shipping_amount= _0x6F61[0][0][0].shipping_amount.toFixed(2);_0x6F86.body.qty= _0x6F61[0][0][0].qty;_0x6F86.body.gateway= _0x6F86.body.gateway?_0x6F86.body.gateway:'\x77\x69\x72\x65';_0x6F86.body.type= _0x6F61[0][0][0].type;_0x6F86.body.product_id= _0x6F61[0][0][0].projectId;_0x6F86.body.transactionid= _0x6F86.body.transaction_id?_0x6F86.body.transaction_id:'';q.all([product.update_transaction(_0x6F86,config.mysql,q),product.generate_invoice(_0x6F86,config.mysql,q)]).then(function(_0x6F61){console.log('\x72\x65\x73\x75\x6C\x74\x73\x5B\x31\x5D\x5B\x30\x5D',_0x6F61[1][0]);_0x6FAB.json({status:200,success:true,result:_0x6F61[1][0],amount:_0x6F86.body.amount});_0x6FAB.end();return false}).fail(function(_0x6F61){_0x6FAB.json({status:500,success:false,error:_0x6F61});_0x6FAB.end();return false}).done()}).fail(function(_0x6F61){_0x6FAB.json({status:500,success:false,error:_0x6F61});_0x6FAB.end();return false}).done()}else {_0x6FAB.json({status:500,success:false,error:'\x69\x6E\x76\x61\x6C\x69\x64\x20\x64\x61\x74\x61'});_0x6FAB.end();return false}});app.post('\x2F\x70\x61\x79',function(_0x6FAB,_0x6FD0){try{var _0x6F86;if(_0x6FAB.body.payment_method_id){console.log('\x72\x65\x71\x2E\x62\x6F\x64\x79\x2E\x70\x61\x79\x6D\x65\x6E\x74\x5F\x6D\x65\x74\x68\x6F\x64\x5F\x69\x64',_0x6FAB.body.payment_method_id);var _0x6F61=parseFloat(_0x6FAB.body.amount).toFixed(2);_0x6F61= _0x6F61.toString().replace('\x2E','');console.log('\x61\x6D\x6F\x75\x6E\x74',_0x6F61);stripe.paymentIntents.create({payment_method:_0x6FAB.body.payment_method_id,amount:_0x6F61,currency:'\x75\x73\x64',confirmation_method:'\x6D\x61\x6E\x75\x61\x6C',confirm:true,description:'\x48\x65\x6D\x70\x62\x75\x79\x65\x72',shipping:{name:_0x6FAB.body.name,address:{line1:'\x35\x31\x30\x20\x54\x6F\x77\x6E\x73\x65\x6E\x64\x20\x53\x74',postal_code:'\x39\x38\x31\x34\x30',city:'\x53\x61\x6E\x20\x46\x72\x61\x6E\x63\x69\x73\x63\x6F',state:'\x43\x41',country:'\x55\x53'}}}).then(function(_0x6F61){_0x6FD0.send(generateResponse(_0x6FAB,_0x6F61))}).catch(function(_0x6F61){console.error(_0x6F61);_0x6FD0.send({success:false,message:_0x6F61.message})})}else {if(_0x6FAB.body.payment_intent_id){stripe.paymentIntents.confirm(_0x6FAB.body.payment_intent_id).then(function(_0x6F61){_0x6FD0.send(generateResponse(_0x6FAB,_0x6F61))}).catch(function(_0x6F61){console.error(_0x6F61);_0x6FD0.send({success:false,message:_0x6F61.message})})}}}catch(e){return _0x6FD0.send({error:e.message,ee:e})}});function generateResponse(_0x6F86,_0x6F61){console.log('\x73\x74\x72\x69\x70\x65\x20\x69\x6E\x74\x65\x6E\x74\x20\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x3D\x20',_0x6F61);if(_0x6F61.status=== '\x72\x65\x71\x75\x69\x72\x65\x73\x5F\x61\x63\x74\x69\x6F\x6E'&& _0x6F61.next_action.type=== '\x75\x73\x65\x5F\x73\x74\x72\x69\x70\x65\x5F\x73\x64\x6B'){return {requires_action:true,payment_intent_client_secret:_0x6F61.client_secret}}else {if(_0x6F61.status=== '\x73\x75\x63\x63\x65\x65\x64\x65\x64'){if(_0x6F86.body.invoice_id> 0){console.log('\x72\x65\x71\x2E\x62\x6F\x64\x79\x2E\x69\x6E\x76\x6F\x69\x63\x65\x5F\x69\x64',_0x6F86.body.invoice_id);_0x6F86.body.id= _0x6F86.body.invoice_id;q.all([product.get_invoice_details(_0x6F86,config.mysql,q)]).then(function(_0x6FAB){_0x6F86.body.gateway= '\x63\x61\x72\x64';_0x6F86.body.tr_transaction_id= _0x6F61.id;_0x6F86.body.tr_invoice_id= _0x6F86.body.invoice_id;_0x6F86.body.status= '\x70\x61\x69\x64';q.all([product.add_transaction_id(_0x6F86,config.mysql,q),product.update_invoice_status(_0x6F86,config.mysql,q)]).then(function(_0x6F61){}).fail(function(_0x6F61){console.log('\x65\x72\x72',_0x6F61)}).done()}).fail(function(_0x6F61){console.log('\x65\x72\x72',_0x6F61)}).done()};return {success:true}}else {return {error:'\x49\x6E\x76\x61\x6C\x69\x64\x20\x50\x61\x79\x6D\x65\x6E\x74\x49\x6E\x74\x65\x6E\x74\x20\x73\x74\x61\x74\x75\x73'}}}}module.exports= app